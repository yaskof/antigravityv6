import React, { useState, useEffect, useMemo } from 'react';
import { 
  Camera, Zap, Download, Settings, RefreshCw, 
  ChevronRight, Share2, Info, AlertTriangle, 
  MapPin, Sparkles, Sliders, Layout, Monitor,
  Flame, Shield, Ghost, Target, Trophy, Compass,
  Palette, Box, Droplets, Wind, Eye, Trash2, Smartphone, X, User, LogIn, Upload, Plus, Globe,
  Star, PenTool, Radio, Lock, Activity, Layers, Maximize2, Search
} from 'lucide-react';
import { Chart as ChartJS, CategoryScale, LinearScale, BarElement, Title, Tooltip, Legend, Filler } from 'chart.js';
import { Bar } from 'react-chartjs-2';

// Firebase Importları
import { initializeApp } from 'firebase/app';
import { getAuth, onAuthStateChanged, signInAnonymously, signInWithCustomToken } from 'firebase/auth';
import { getFirestore, collection, query, onSnapshot, addDoc, serverTimestamp, doc } from 'firebase/firestore';

// ChartJS Kaydı
ChartJS.register(CategoryScale, LinearScale, BarElement, Title, Tooltip, Legend, Filler);

// --- YAPILANDIRMA ---
const apiKey = ""; 
const MODEL_NAME = "gemini-2.5-flash-image-preview";
const appId = "antigravity-garage-v6-120scenes";

// Firebase Kurulumu
let db, auth;
try {
  const firebaseConfig = typeof __firebase_config !== 'undefined' 
    ? JSON.parse(__firebase_config) 
    : { apiKey: "demo-mode", authDomain: "demo.firebaseapp.com", projectId: "demo-project" };
  const app = initializeApp(firebaseConfig);
  auth = getAuth(app);
  db = getFirestore(app);
} catch (e) {
  console.warn("Firebase bağlantısı demo modunda.");
}

// --- VERİ SETLERİ ---

const MOD_TEMPLATES = [
  { id: 'm_performance', name: 'M-Performance', prompt: 'BMW M-style carbon fiber front splitter, side skirts, quad exhaust, M-forged wheels.', icon: <Zap size={18}/> },
  { id: 'brabus_spec', name: 'Brabus Black', prompt: 'Brabus stealth aesthetic: gloss black chrome-delete, Monoblock rims, carbon hood scoops.', icon: <Shield size={18}/> },
  { id: 'abt_audi', name: 'ABT Sports', prompt: 'ABT aerodynamic kit: subtle rear wing, specific GR alloy wheels, carbon intake.', icon: <Activity size={18}/> },
  { id: 'techart_porsche', name: 'TechArt GT', prompt: 'TechArt performance kit: active rear spoiler, center-lock wheels, fender vents.', icon: <PenTool size={18}/> },
  { id: 'mansory_forged', name: 'Mansory Ed.', prompt: 'Forged carbon fiber panels (hood, mirrors, wing). Mansory signature luxury wheels.', icon: <Droplets size={18}/> },
  { id: 'lb_wide', name: 'LB-Works', prompt: 'Bolt-on wide fender flares, extreme deep-dish rims, massive GT wing, slammed stance.', icon: <Layers size={18}/> }
];

// 120 SAHNE VERİ SETİ
const BACKGROUND_MODES = [
  // --- TÜRKİYE (30) ---
  { id: 'bosphorus_night', cat: 'Türkiye', name: 'Boğaz Köprüsü (Gece)', prompt: 'Night at Istanbul Bosphorus Bridge, glowing city lights, deep blue sea reflections' },
  { id: 'galata_tower', cat: 'Türkiye', name: 'Galata Kulesi', prompt: 'Galata Tower Istanbul, narrow historic stone streets, warm golden street lamps' },
  { id: 'maiden_tower', cat: 'Türkiye', name: 'Kız Kulesi (Gün Batımı)', prompt: 'Istanbul Maiden\'s Tower at sunset, fiery orange sky, calm sea waves' },
  { id: 'cappadocia_balloons', cat: 'Türkiye', name: 'Kapadokya Balonları', prompt: 'Sunrise in Cappadocia, hundreds of hot air balloons, fairy chimneys, misty valley' },
  { id: 'pamukkale_thermal', cat: 'Türkiye', name: 'Pamukkale Travertenleri', prompt: 'Pamukkale white calcium terraces, turquoise thermal water, soft morning light' },
  { id: 'ephesus_library', cat: 'Türkiye', name: 'Efes Celsus Kütüphanesi', prompt: 'Ancient Ephesus Celsus Library ruins, majestic columns, historic archaeological site' },
  { id: 'salda_lake', cat: 'Türkiye', name: 'Salda Gölü', prompt: 'Lake Salda, white sands, crystal turquoise water, bright Mediterranean sun' },
  { id: 'mardin_houses', cat: 'Türkiye', name: 'Eski Mardin Evleri', prompt: 'Old Mardin yellow stone architecture, Mesopotamian valley view, historic evening glow' },
  { id: 'nemrut_mount', cat: 'Türkiye', name: 'Nemrut Dağı Zirve', prompt: 'Mount Nemrut summit, giant ancient stone heads, dramatic mountain sunrise' },
  { id: 'sumela_monastery', cat: 'Türkiye', name: 'Sümela Manastırı', prompt: 'Sumela Monastery on the cliff, misty mountain forest, Black Sea region vibe' },
  { id: 'anitkabir_ankara', cat: 'Türkiye', name: 'Anıtkabir', prompt: 'Anitkabir Ankara, grand monumental architecture, lion road, dramatic blue sky' },
  { id: 'kas_coastal', cat: 'Türkiye', name: 'Kaş Sahil Yolu', prompt: 'Antalya Kaş winding coastal road, turquoise Mediterranean sea view, summer haze' },
  { id: 'yedigoller_autumn', cat: 'Türkiye', name: 'Yedigöller (Sonbahar)', prompt: 'Seven Lakes Bolu, autumn colors, vibrant orange and red leaves, misty forest' },
  { id: 'uludag_snow', cat: 'Türkiye', name: 'Uludağ Zirve (Kar)', prompt: 'Uludag snowy mountain peak, ski resort atmosphere, pine trees, winter magic' },
  { id: 'izmir_clock_tower', cat: 'Türkiye', name: 'İzmir Saat Kulesi', prompt: 'Izmir Clock Tower Konak, palm trees, Aegean breeze, sunset lighting' },
  { id: 'oludeniz_lagoon', cat: 'Türkiye', name: 'Ölüdeniz Lagünü', prompt: 'Fethiye Oludeniz blue lagoon, paragliders in sky, turquoise water' },
  { id: 'ishak_pasha', cat: 'Türkiye', name: 'İshak Paşa Sarayı', prompt: 'Ishak Pasha Palace, ottoman architecture, rugged mountain background, sunset' },
  { id: 'pergamum_acropolis', cat: 'Türkiye', name: 'Bergama Akropolü', prompt: 'Ancient Pergamum Acropolis, steep amphitheater, historic marble ruins' },
  { id: 'butterfly_valley', cat: 'Türkiye', name: 'Kelebekler Vadisi', prompt: 'Butterfly Valley Fethiye, high canyon walls, secluded beach, azure water' },
  { id: 'erciyes_mountain', cat: 'Türkiye', name: 'Erciyes Dağı', prompt: 'Mount Erciyes volcano, snowy peak, Kayseri city lights in distance' },
  { id: 'van_lake_akdamar', cat: 'Türkiye', name: 'Van Gölü Akdamar', prompt: 'Lake Van Akdamar Island, ancient armenian church, almond trees, blue lake' },
  { id: 'goksu_waterfall', cat: 'Türkiye', name: 'Göksu Şelalesi', prompt: 'Antalya Goksu Waterfall, lush green nature, flowing white water, tropical vibe' },
  { id: 'safranbolu_street', cat: 'Türkiye', name: 'Safranbolu Sokakları', prompt: 'Safranbolu historic ottoman houses, cobblestone streets, traditional village atmosphere' },
  { id: 'hattusa_lions', cat: 'Türkiye', name: 'Hattuşaş Aslanlı Kapı', prompt: 'Ancient Hittite capital Hattusa, lion gate, massive stone walls, historical aura' },
  { id: 'troy_horse', cat: 'Türkiye', name: 'Truva Atı', prompt: 'Troy ancient city, wooden horse monument, sunset over Dardanelles' },
  { id: 'dilek_peninsula', cat: 'Türkiye', name: 'Dilek Yarımadası', prompt: 'Kusadasi Dilek Peninsula, pristine forest meets Aegean sea, wild nature' },
  { id: 'datca_old_town', cat: 'Türkiye', name: 'Eski Datça', prompt: 'Old Datca stone houses, narrow flowery streets, bohemian Mediterranean style' },
  { id: 'bodrum_marina', cat: 'Türkiye', name: 'Bodrum Marina', prompt: 'Bodrum Castle background, luxury yachts, white houses, summer night' },
  { id: 'aspendos_theater', cat: 'Türkiye', name: 'Aspendos Tiyatrosu', prompt: 'Ancient Aspendos Roman theater, perfectly preserved stone arena, cinematic lighting' },
  { id: 'istanbul_skyline', cat: 'Türkiye', name: 'İstanbul Skyline', prompt: 'Modern Istanbul skyline, Levent skyscrapers, glowing city at dusk' },

  // --- DÜNYA ŞEHİRLERİ (30) ---
  { id: 'tokyo_shibuya', cat: 'Şehir', name: 'Tokyo Shibuya', prompt: 'Tokyo Shibuya crossing at night, neon signs, rainy reflections, futuristic neon' },
  { id: 'ny_times_square', cat: 'Şehir', name: 'NY Times Square', prompt: 'New York Times Square, giant LED billboards, urban energy, yellow cabs' },
  { id: 'paris_eiffel', cat: 'Şehir', name: 'Eyfel Kulesi', prompt: 'Eiffel Tower Paris, evening sparkles, Seine river background, romantic lights' },
  { id: 'london_tower_bridge', cat: 'Şehir', name: 'Londra Tower Bridge', prompt: 'London Tower Bridge, Thames river, moody British overcast, city lights' },
  { id: 'dubai_burj_khalifa', cat: 'Şehir', name: 'Dubai Burj Khalifa', prompt: 'Burj Khalifa background, modern skyscrapers, desert luxury city, high-end' },
  { id: 'monaco_harbor', cat: 'Şehir', name: 'Monaco Marina', prompt: 'Luxury Monaco harbor, super yachts, azure water, hillside wealth' },
  { id: 'rome_colosseum', cat: 'Şehir', name: 'Roma Kolezyum', prompt: 'Rome Colosseum, historic Italian vibe, warm sunset, cobblestone' },
  { id: 'hong_kong_skyline', cat: 'Şehir', name: 'Hong Kong Skyline', prompt: 'Victoria Harbor HK, dense skyscrapers, laser show, mountain background' },
  { id: 'seoul_gangnam', cat: 'Şehir', name: 'Seul Gangnam', prompt: 'Seoul modern architecture, neon lights, high tech vibe, k-pop aesthetic' },
  { id: 'berlin_wall', cat: 'Şehir', name: 'Berlin Duvarı', prompt: 'Berlin East Side Gallery, urban street art, modern city history' },
  { id: 'amsterdam_canal', cat: 'Şehir', name: 'Amsterdam Kanalları', prompt: 'Amsterdam canal houses, historic boats, evening golden glow, reflections' },
  { id: 'moscow_red_square', cat: 'Şehir', name: 'Moskova Kızıl Meydan', prompt: 'Moscow Red Square, Saint Basil\'s Cathedral, snowy winter, historic' },
  { id: 'sydney_opera_house', cat: 'Şehir', name: 'Sidney Opera Evi', prompt: 'Sydney Harbor, Opera House, bridge view, bright blue ocean' },
  { id: 'singapore_gardens', cat: 'Şehir', name: 'Singapur Gardens', prompt: 'Gardens by the Bay, futuristic tree structures, tropical city lights' },
  { id: 'rio_de_janeiro', cat: 'Şehir', name: 'Rio de Janeiro', prompt: 'Rio skyline, Sugarloaf Mountain, Copacabana beach from above' },
  { id: 'shanghai_bund', cat: 'Şehir', name: 'Şanghay Bund', prompt: 'Shanghai Bund skyline, Pearl Tower, modern futuristic skyscrapers' },
  { id: 'barcelona_sagrada', cat: 'Şehir', name: 'Barselona Sagrada', prompt: 'Gaudi Sagrada Familia, unique architecture, Mediterranean sun' },
  { id: 'venice_grand_canal', cat: 'Şehir', name: 'Venedik Kanalları', prompt: 'Venice grand canal, gondolas, historic italian palaces on water' },
  { id: 'san_fran_bridge', cat: 'Şehir', name: 'San Francisco Köprüsü', prompt: 'Golden Gate Bridge, San Francisco bay, foggy morning atmosphere' },
  { id: 'chicago_loop', cat: 'Şehir', name: 'Chicago Skyline', prompt: 'Chicago loop, skyscrapers, Michigan lake, windy city vibe' },
  { id: 'toronto_cn_tower', cat: 'Şehir', name: 'Toronto CN Tower', prompt: 'Toronto skyline from lake Ontario, CN Tower, modern canada city' },
  { id: 'cairo_pyramids', cat: 'Şehir', name: 'Kahire Piramitler', prompt: 'Great Pyramids of Giza, desert sand, ancient egypt grandeur' },
  { id: 'mumbai_gateway', cat: 'Şehir', name: 'Mumbai Geçidi', prompt: 'Gateway of India, Arabian sea, busy harbor, colonial architecture' },
  { id: 'bangkok_temple', cat: 'Şehir', name: 'Bangkok Tapınakları', prompt: 'Wat Arun Bangkok, golden temple spires, Chao Phraya river' },
  { id: 'la_hollywood', cat: 'Şehir', name: 'LA Hollywood', prompt: 'Hollywood sign background, palm trees, California sunset, luxury hills' },
  { id: 'miami_ocean_drive', cat: 'Şehir', name: 'Miami Ocean Drive', prompt: 'Miami art deco district, neon signs, palm trees, beach drive' },
  { id: 'prague_old_town', cat: 'Şehir', name: 'Prag Eski Şehir', prompt: 'Charles Bridge Prague, gothic towers, Vltava river, european magic' },
  { id: 'vienna_opera', cat: 'Şehir', name: 'Viyana Devlet Operası', prompt: 'Vienna classic architecture, grand opera house, imperial style' },
  { id: 'athens_acropolis', cat: 'Şehir', name: 'Atina Akropol', prompt: 'Acropolis of Athens, Parthenon temple, rocky hill, ancient greek' },
  { id: 'las_vegas_strip', cat: 'Şehir', name: 'Las Vegas Strip', prompt: 'Vegas night, neon casinos, Eiffel replica, fountain show' },

  // --- DOĞA MANZARALARI (30) ---
  { id: 'swiss_alps_snow', cat: 'Doğa', name: 'İsviçre Alpleri', prompt: 'Snowy Swiss Alps mountain pass, pine trees, winter magic, clear air' },
  { id: 'sahara_dunes', cat: 'Doğa', name: 'Sahra Çölü', prompt: 'Sahara desert dunes, golden sand waves, high sun, extreme heat haze' },
  { id: 'iceland_aurora', cat: 'Doğa', name: 'İzlanda Aurora', prompt: 'Icelandic volcanic landscape, bright green Northern Lights sky' },
  { id: 'amazon_forest', cat: 'Doğa', name: 'Amazon Ormanı', prompt: 'Dense Amazon rainforest, tropical humidity, sunlight through canopy' },
  { id: 'norway_fjord_view', cat: 'Doğa', name: 'Norveç Fiyortları', prompt: 'Norwegian fjords, deep blue water, towering cliffs, misty mountain' },
  { id: 'bali_terraces', cat: 'Doğa', name: 'Bali Pirinç Tarlaları', prompt: 'Bali Ubud rice terraces, lush green jungle, tropical mist, sunrise' },
  { id: 'grand_canyon_az', cat: 'Doğa', name: 'Grand Canyon', prompt: 'Grand Canyon Arizona, deep red canyons, dramatic sunlight and shadows' },
  { id: 'bora_bora_paradise', cat: 'Doğa', name: 'Bora Bora', prompt: 'Bora Bora turquoise lagoon, overwater bungalows, white sand' },
  { id: 'yosemite_falls', cat: 'Doğa', name: 'Yosemite Şelaleleri', prompt: 'Yosemite valley, granite cliffs, giant waterfalls, pine forest' },
  { id: 'bonneville_flats', cat: 'Doğa', name: 'Tuz Gölü (Bonneville)', prompt: 'Bonneville Salt Flats, flat white ground, mirror reflections' },
  { id: 'everest_base_camp', cat: 'Doğa', name: 'Everest Kampı', prompt: 'Mount Everest peak, snowy Himalayan range, high altitude atmosphere' },
  { id: 'santorini_sunset', cat: 'Doğa', name: 'Santorini (Gün Batımı)', prompt: 'Santorini Oia sunset, blue dome churches, white buildings on cliff' },
  { id: 'great_barrier_reef', cat: 'Doğa', name: 'Büyük Bariyer Resifi', prompt: 'Australian coral reef seen from boat, turquoise ocean, tropical sun' },
  { id: 'antartica_icebergs', cat: 'Doğa', name: 'Antarktika Buzulları', prompt: 'Antarctic blue icebergs, freezing ocean, dramatic polar lighting' },
  { id: 'victoria_falls', cat: 'Doğa', name: 'Victoria Şelaleleri', prompt: 'Victoria Falls rainbow, massive water spray, african jungle background' },
  { id: 'fuji_mountain', cat: 'Doğa', name: 'Fuji Dağı', prompt: 'Mount Fuji Japan, cherry blossoms, snow cap, calm lake' },
  { id: 'dead_sea_israel', cat: 'Doğa', name: 'Lut Gölü (Ölü Deniz)', prompt: 'Dead Sea salt formations, crystal blue water, desert mountains' },
  { id: 'dolomites_italy', cat: 'Doğa', name: 'Dolomit Dağları', prompt: 'Italian Dolomites, jagged peaks, alpine meadows, sunrise glow' },
  { id: 'galapagos_islands', cat: 'Doğa', name: 'Galapagos Adaları', prompt: 'Volcanic islands, exotic beach, clear water, untouched nature' },
  { id: 'serengeti_savannah', cat: 'Doğa', name: 'Serengeti Savanası', prompt: 'African savannah, acacia trees, golden grass, vast horizon' },
  { id: 'torres_del_paine', cat: 'Doğa', name: 'Patagonya Dağları', prompt: 'Torres del Paine peaks, glacier lake, rugged wilderness' },
  { id: 'halong_bay', cat: 'Doğa', name: 'Halong Körfezi', prompt: 'Vietnam Halong Bay, limestone islands, emerald water, mist' },
  { id: 'baobab_avenue', cat: 'Doğa', name: 'Baobab Yolu', prompt: 'Madagascar Baobab trees, giant silhouettes, red soil, sunset' },
  { id: 'baikal_lake', cat: 'Doğa', name: 'Baykal Gölü', prompt: 'Lake Baikal frozen ice, deep blue cracks, siberian winter' },
  { id: 'atacama_desert', cat: 'Doğa', name: 'Atacama Çölü', prompt: 'Chile Atacama desert, red rocks, blue lagoons, high altitude sky' },
  { id: 'redwood_forest', cat: 'Doğa', name: 'Redwood Ormanı', prompt: 'California giant redwood trees, mystical fog, sunlight beams' },
  { id: 'moher_cliffs', cat: 'Doğa', name: 'Moher Kayalıkları', prompt: 'Ireland Cliffs of Moher, dramatic ocean waves, green cliffs' },
  { id: 'kilimanjaro_peak', cat: 'Doğa', name: 'Kilimanjaro Dağı', prompt: 'Mount Kilimanjaro snowy peak from savannah, Amboseli vibe' },
  { id: 'plitvice_lakes', cat: 'Doğa', name: 'Plitvice Gölleri', prompt: 'Croatia Plitvice waterfalls, terraced lakes, turquoise water, lush forest' },
  { id: 'maui_ocean_road', cat: 'Doğa', name: 'Maui Sahil Yolu', prompt: 'Hawaii coastal road, volcanic rocks, lush tropical jungle, pacific waves' },

  // --- ENDÜSTRİYEL & TUNING (30) ---
  { id: 'tokyo_underground', cat: 'Tuning', name: 'Tokyo Yeraltı Garajı', prompt: 'Cyberpunk underground parking lot in Tokyo, industrial pipes, dim neon' },
  { id: 'nurburgring_track', cat: 'Tuning', name: 'Nürburgring Pisti', prompt: 'Nürburgring Nordschleife track, kerbs, high speed motion blur' },
  { id: 'retro_gas_station', cat: 'Tuning', name: 'Retro Benzinlik', prompt: '1950s American neon gas station, Route 66 vibe, vintage' },
  { id: 'dark_studio_pro', cat: 'Tuning', name: 'Karanlık Stüdyo', prompt: 'Premium car photography studio, pure black floor, soft lights' },
  { id: 'modern_garage_glass', cat: 'Tuning', name: 'Modern Cam Garaj', prompt: 'Luxury glass garage house, minimalist, sunset mountain view' },
  { id: 'car_meet_night', cat: 'Tuning', name: 'Gece Buluşması', prompt: 'Outdoor night car meet, multiple neon lights, street tuning vibe' },
  { id: 'abandoned_factory', cat: 'Tuning', name: 'Terkedilmiş Fabrika', prompt: 'Abandoned industrial factory, rust, dramatic light shafts' },
  { id: 'racing_pit_lane', cat: 'Tuning', name: 'F1 Pit Alanı', prompt: 'Modern Formula 1 pit lane, race team tools, high tech' },
  { id: 'drift_zone_track', cat: 'Tuning', name: 'Drift Alanı', prompt: 'Drift event track, tire smoke, concrete barriers, crowd' },
  { id: 'port_terminal', cat: 'Tuning', name: 'Liman Terminali', prompt: 'Industrial container port, massive cranes, cargo ships background' },
  { id: 'cargo_hangar', cat: 'Tuning', name: 'Kargo Hangarı', prompt: 'Aviation hangar, reflective concrete floor, massive open doors' },
  { id: 'steel_mill', cat: 'Tuning', name: 'Çelik Fabrikası', prompt: 'Industrial steel mill, glowing molten metal, sparks, dark interior' },
  { id: 'underground_tunnel', cat: 'Tuning', name: 'Yeraltı Tüneli', prompt: 'High-speed modern tunnel, leading lines, motion blur lights' },
  { id: 'rooftop_parking', cat: 'Tuning', name: 'Otopark Çatısı', prompt: 'City skyscraper rooftop parking, urban skyline background at night' },
  { id: 'cyberpunk_street', cat: 'Tuning', name: 'Cyberpunk Sokak', prompt: 'Neo-Tokyo street, holographic ads, rain, wet asphalt, neon' },
  { id: 'lowrider_alley', cat: 'Tuning', name: 'Lowrider Sokağı', prompt: 'East LA style alley, graffiti walls, brick textures, sunny day' },
  { id: 'drag_strip', cat: 'Tuning', name: 'Drag Pisti', prompt: 'Professional drag strip, Christmas tree lights, burnt rubber smoke' },
  { id: 'dyno_cell', cat: 'Tuning', name: 'Dyno Test Odası', prompt: 'High-tech tuning dyno cell, cooling fans, monitors, sensors' },
  { id: 'paint_booth', cat: 'Tuning', name: 'Boya Kabini', prompt: 'Professional clean paint booth, bright white lights, ventilation' },
  { id: 'classic_workshop', cat: 'Tuning', name: 'Klasik Atölye', prompt: 'Old school car workshop, wooden tools, vintage posters, oil smells' },
  { id: 'high_tech_lab', cat: 'Tuning', name: 'Yüksek Teknoloji Labı', prompt: 'Futuristic research lab, holographic displays, robotic arms' },
  { id: 'carbon_fiber_lab', cat: 'Tuning', name: 'Karbon Fiber Labı', prompt: 'Bespoke carbon fiber manufacturing lab, clean room, composite parts' },
  { id: 'wind_tunnel', cat: 'Tuning', name: 'Rüzgar Tüneli', prompt: 'Aerodynamic wind tunnel, massive turbine, smoke trail visualization' },
  { id: 'military_airbase', cat: 'Tuning', name: 'Askeri Hava Üssü', prompt: 'Air force base runway, fighter jets in background, rugged tarmac' },
  { id: 'oil_rig_platform', cat: 'Tuning', name: 'Petrol Platformu', prompt: 'Offshore oil rig at night, stormy sea, industrial machinery' },
  { id: 'helipad_skyscraper', cat: 'Tuning', name: 'Gökdelen Helipisti', prompt: 'Top of a skyscraper, helipad circle, 360 degree city view' },
  { id: 'luxury_villa_driveway', cat: 'Tuning', name: 'Lüks Villa Girişi', prompt: 'Modern architectural villa driveway, minimalist design, exotic plants' },
  { id: 'wangan_expressway', cat: 'Tuning', name: 'Tokyo Wangan Otoyolu', prompt: 'Tokyo Shuto Expressway, ocean view, tunnel entrance, city lights' },
  { id: 'neon_bridge_future', cat: 'Tuning', name: 'Neon Köprü', prompt: 'Futuristic bridge with RGB LED strips, dark night sky, sleek surface' },
  { id: 'off_road_desert_base', cat: 'Tuning', name: 'Çöl Operasyon Merkezi', prompt: 'Rugged desert outpost, heavy machinery, orange dust, military vibe' }
];

const COLORS = [
  { id: 'none', name: 'Orijinal', hex: 'transparent' },
  { id: 'frozen', name: 'Mat Siyah', hex: '#111' },
  { id: 'nardo', name: 'Nardo Gri', hex: '#4b5563' },
  { id: 'yas', name: 'Marina Mavi', hex: '#7dd3fc' },
  { id: 'candy', name: 'Şeker Kırmızı', hex: '#991b1b' }
];

// --- ANA BİLEŞEN ---

export default function App() {
  const [user, setUser] = useState(null);
  const [garage, setGarage] = useState([]);
  const [originalImage, setOriginalImage] = useState(null);
  const [customPartImages, setCustomPartImages] = useState([]);
  const [modifiedImage, setModifiedImage] = useState(null);
  const [isGenerating, setIsGenerating] = useState(false);
  const [activeTab, setActiveTab] = useState('style'); 
  const [showDownloadModal, setShowDownloadModal] = useState(false);
  
  const [selectedStyle, setSelectedStyle] = useState(MOD_TEMPLATES[0]);
  const [selectedBG, setSelectedBG] = useState(BACKGROUND_MODES[0]);
  const [selectedColor, setSelectedColor] = useState(COLORS[0]);
  
  // Arama ve Filtre State
  const [searchTerm, setSearchTerm] = useState('');
  const [selectedCategory, setSelectedCategory] = useState('All');
  
  const [sliderPosition, setSliderPosition] = useState(50);
  const [statusMessage, setStatusMessage] = useState('');
  const [error, setError] = useState(null);

  // Auth & Firestore
  useEffect(() => {
    if (!auth) return;
    const initAuth = async () => {
      try {
        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
          await signInWithCustomToken(auth, __initial_auth_token);
        } else {
          await signInAnonymously(auth);
        }
      } catch (err) { console.error("Auth:", err); }
    };
    initAuth();
    const unsubscribe = onAuthStateChanged(auth, setUser);
    return () => unsubscribe();
  }, []);

  useEffect(() => {
    if (!user || !db) return;
    const q = query(collection(db, 'artifacts', appId, 'users', user.uid, 'garage'));
    const unsubscribe = onSnapshot(q, (snapshot) => {
      const items = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }))
        .sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
      setGarage(items);
    }, (err) => console.error("Firestore Error:", err));
    return () => unsubscribe();
  }, [user]);

  // Filtrelenmiş Sahneler
  const filteredBackgrounds = useMemo(() => {
    return BACKGROUND_MODES.filter(bg => {
      const matchesSearch = bg.name.toLowerCase().includes(searchTerm.toLowerCase());
      const matchesCat = selectedCategory === 'All' || bg.cat === selectedCategory;
      return matchesSearch && matchesCat;
    });
  }, [searchTerm, selectedCategory]);

  const handleImageUpload = (e, type = 'car') => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onloadend = () => {
        if (type === 'car') {
          setOriginalImage(reader.result);
          setModifiedImage(null);
        } else {
          setCustomPartImages(prev => [...prev, { id: Date.now(), data: reader.result }]);
        }
      };
      reader.readAsDataURL(file);
    }
  };

  const removePart = (id) => setCustomPartImages(prev => prev.filter(p => p.id !== id));

  const generateModification = async () => {
    if (!originalImage || !user) return;
    setIsGenerating(true);
    setError(null);
    setStatusMessage('Sistem Analiz Ediliyor...');

    try {
      const carBase64 = originalImage.includes(',') ? originalImage.split(',')[1] : originalImage;
      const masterPrompt = `
        STRICT IDENTITY PROTECTION: 
        1. Keep original headlights, grille, and body shell of the uploaded car exactly as is.
        2. DO NOT change the car make or model.
        3. MODIFICATION OVERLAY: Apply ${selectedStyle.prompt}.
        4. PAINT FINISH: Use ${selectedColor.name} paint style.
        5. SCENE: Place it in ${selectedBG.prompt}.
        6. TECHNICAL: Professional 8K automotive photography, realistic ray-tracing, crisp detail.
      `;

      const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${apiKey}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          contents: [{ parts: [{ text: masterPrompt }, { inlineData: { mimeType: "image/png", data: carBase64 } }] }],
          generationConfig: { 
            responseModalities: ['TEXT', 'IMAGE'],
            temperature: 0.2,
            topP: 0.95
          }
        })
      });

      if (!res.ok) throw new Error("Yapay zeka motoruna ulaşılamadı.");
      const result = await res.json();
      const imgData = result.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
      if (!imgData) throw new Error("Görsel işleme hatası oluştu.");
      
      const resultImage = `data:image/png;base64,${imgData}`;
      setModifiedImage(resultImage);
      
      if (db && user) {
        await addDoc(collection(db, 'artifacts', appId, 'users', user.uid, 'garage'), {
          style: selectedStyle.name, location: selectedBG.name, result: resultImage, createdAt: serverTimestamp()
        });
      }
      setStatusMessage('Sistem Hazır!');
    } catch (err) { 
      setError("Hata: " + err.message); 
    }
    finally { setIsGenerating(false); }
  };

  // İNDİRME MOTORU (FIXED)
  const processDownload = (type) => {
    if (!modifiedImage) return;
    const img = new Image();
    img.crossOrigin = "anonymous"; // CORS güvenliği
    img.src = modifiedImage;
    img.onload = () => {
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      let tW, tH;
      
      // Boyutlandırma Mantığı
      if (type === 'mobile') { tW = 1080; tH = 1920; }
      else if (type === 'pc') { tW = 1920; tH = 1080; }
      else { tW = img.width; tH = img.height; }
      
      canvas.width = tW; 
      canvas.height = tH;
      
      const scale = Math.max(tW / img.width, tH / img.height);
      const x = (tW / 2) - (img.width / 2) * scale;
      const y = (tH / 2) - (img.height / 2) * scale;
      
      ctx.fillStyle = "#000";
      ctx.fillRect(0,0,tW,tH);
      ctx.drawImage(img, x, y, img.width * scale, img.height * scale);
      
      // İndirme tetikleyici (Robust Link Injection)
      try {
        const dataUrl = canvas.toDataURL('image/png');
        const link = document.createElement('a');
        link.href = dataUrl;
        link.download = `antigravity-studio-${type}-${Date.now()}.png`;
        document.body.appendChild(link); // DOM'a zorla ekle
        link.click();
        document.body.removeChild(link); // Hemen temizle
        setShowDownloadModal(false);
      } catch (err) {
        console.error("İndirme Hatası:", err);
        setError("Tarayıcınız indirme işlemine izin vermedi.");
      }
    };
  };

  const chartData = {
    labels: ['Şasi', 'Parça', 'Işık', 'Doku', 'Derinlik'],
    datasets: [{
      label: 'Sistem Analizi',
      data: [100, 95, 90, 92, 88],
      backgroundColor: 'rgba(6, 182, 212, 0.2)',
      borderColor: 'rgba(6, 182, 212, 1)',
      borderWidth: 2,
      fill: true,
      tension: 0.4
    }],
  };

  return (
    <div className="min-h-screen bg-[#020202] text-slate-200 font-mono overflow-x-hidden">
      {/* HUD ARKA PLAN EFEKTLERİ */}
      <div className="fixed inset-0 pointer-events-none z-0 opacity-40">
        <div className="absolute top-0 left-0 w-full h-full bg-[radial-gradient(circle_at_50%_-20%,#0e7490_0%,transparent_50%)]"></div>
        <div className="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 brightness-100"></div>
        <div className="absolute w-full h-px bg-cyan-500/20 top-20"></div>
        <div className="absolute w-px h-full bg-cyan-500/20 left-1/4 hidden lg:block"></div>
        <div className="absolute w-px h-full bg-cyan-500/20 right-1/4 hidden lg:block"></div>
      </div>

      <header className="relative z-50 h-20 flex items-center justify-between px-8 border-b border-white/5 backdrop-blur-xl bg-black/40">
        <div className="flex items-center gap-6">
          <div className="w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-600 rounded-lg flex items-center justify-center rotate-45 shadow-[0_0_25px_rgba(34,211,238,0.4)]">
            <Zap className="text-black -rotate-45 fill-current" size={24} />
          </div>
          <div>
            <h1 className="text-2xl font-black tracking-widest uppercase italic text-white leading-none">ANTIGRAVITY <span className="text-cyan-400">V6</span></h1>
            <p className="text-[10px] tracking-[0.6em] text-cyan-500/60 uppercase mt-1 text-xs">Advanced Tuning Architecture</p>
          </div>
        </div>
        <div className="flex items-center gap-4">
          <div className="px-4 py-2 bg-white/5 border border-white/10 rounded-md flex items-center gap-3">
             <div className="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></div>
             <span className="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">Diagnostic Live</span>
          </div>
          <button onClick={() => window.location.reload()} className="p-2.5 bg-white/5 rounded-md hover:bg-red-500/20 border border-white/10 transition-colors">
            <Trash2 size={18} className="text-slate-500 hover:text-red-500" />
          </button>
        </div>
      </header>

      <main className="relative z-10 max-w-[1800px] mx-auto p-6 lg:p-8 grid lg:grid-cols-12 gap-8 h-[calc(100vh-80px)]">
        
        {/* SOL PANEL: AYARLAR */}
        <aside className="lg:col-span-3 flex flex-col gap-4 overflow-hidden">
          <div className="bg-white/5 border border-white/10 rounded-2xl p-4 backdrop-blur-md flex flex-col flex-1 overflow-hidden shadow-2xl">
            <div className="flex gap-2 p-1 bg-black/40 rounded-xl mb-6 border border-white/5">
              {[
                {id: 'style', label: 'STIL', icon: <Layout size={14}/>},
                {id: 'bg', label: 'SAHNE', icon: <Globe size={14}/>},
                {id: 'parts', label: 'EK', icon: <Plus size={14}/>}
              ].map(tab => (
                <button 
                  key={tab.id} 
                  onClick={() => setActiveTab(tab.id)}
                  className={`flex-1 flex items-center justify-center gap-2 py-3 rounded-lg text-[10px] font-black tracking-widest transition-all duration-300 ${activeTab === tab.id ? 'bg-cyan-500 text-black shadow-lg shadow-cyan-500/20' : 'text-slate-500 hover:text-white hover:bg-white/5'}`}
                >
                  {tab.icon} {tab.label}
                </button>
              ))}
            </div>

            <div className="flex-1 overflow-y-auto custom-scrollbar pr-2 space-y-2">
              {activeTab === 'style' && MOD_TEMPLATES.map(tpl => (
                <button key={tpl.id} onClick={() => setSelectedStyle(tpl)} className={`w-full p-4 rounded-xl text-left border transition-all group flex items-center gap-4 ${selectedStyle.id === tpl.id ? 'bg-cyan-500/10 border-cyan-400/50 text-white' : 'bg-transparent border-white/5 text-slate-500 hover:border-white/20'}`}>
                  <div className={`p-2 rounded-lg ${selectedStyle.id === tpl.id ? 'bg-cyan-500 text-black' : 'bg-white/5'}`}>{tpl.icon}</div>
                  <div>
                    <p className="text-xs font-black tracking-tighter uppercase">{tpl.name}</p>
                    <p className="text-[9px] opacity-40 mt-0.5 uppercase tracking-widest">Aktif Şablon</p>
                  </div>
                </button>
              ))}

              {activeTab === 'bg' && (
                <div className="space-y-4">
                  <div className="relative group">
                    <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-600 group-focus-within:text-cyan-500" size={14} />
                    <input 
                      type="text" 
                      placeholder="SAHNE ARA..." 
                      value={searchTerm}
                      onChange={(e) => setSearchTerm(e.target.value)}
                      className="w-full bg-black/40 border border-white/5 rounded-xl py-3 pl-10 pr-4 text-[10px] font-bold tracking-widest focus:outline-none focus:border-cyan-500/50 transition-all uppercase"
                    />
                  </div>
                  <div className="flex gap-1 overflow-x-auto no-scrollbar pb-2">
                    {['All', 'Türkiye', 'Şehir', 'Doğa', 'Tuning'].map(cat => (
                      <button 
                        key={cat}
                        onClick={() => setSelectedCategory(cat)}
                        className={`px-3 py-1.5 rounded-lg text-[8px] font-black uppercase border transition-all whitespace-nowrap ${selectedCategory === cat ? 'bg-white text-black border-white' : 'bg-white/5 border-transparent text-slate-500 hover:text-white'}`}
                      >
                        {cat}
                      </button>
                    ))}
                  </div>
                  <div className="space-y-2">
                    {filteredBackgrounds.map(bg => (
                      <button key={bg.id} onClick={() => setSelectedBG(bg)} className={`w-full p-4 rounded-xl text-left border transition-all ${selectedBG.id === bg.id ? 'bg-cyan-500/10 border-cyan-400/50 text-white shadow-inner' : 'bg-transparent border-white/5 text-slate-500 hover:border-white/20'}`}>
                         <p className="text-[10px] font-black tracking-tighter uppercase leading-tight">{bg.name}</p>
                         <span className="text-[7px] bg-white/5 px-2 py-0.5 rounded text-cyan-500 mt-1.5 inline-block font-bold tracking-widest">{bg.cat}</span>
                      </button>
                    ))}
                    {filteredBackgrounds.length === 0 && (
                      <p className="text-[9px] text-center text-slate-600 mt-10 uppercase tracking-widest">Sahne Bulunamadı</p>
                    )}
                  </div>
                </div>
              )}

              {activeTab === 'parts' && (
                <div className="space-y-4">
                  <label className="flex flex-col items-center justify-center p-8 bg-black/40 border border-dashed border-white/10 rounded-2xl cursor-pointer hover:bg-cyan-500/5 hover:border-cyan-500/30 transition-all group">
                    <Plus className="text-cyan-500 mb-2 group-hover:scale-125 transition-transform" />
                    <span className="text-[9px] font-black tracking-[0.2em] text-slate-500 uppercase">PARÇA YÜKLE</span>
                    <input type="file" className="hidden" onChange={(e) => handleImageUpload(e, 'part')} />
                  </label>
                  {customPartImages.map(p => (
                    <div key={p.id} className="p-2 bg-white/5 border border-white/10 rounded-xl flex items-center justify-between">
                       <img src={p.data} className="w-10 h-10 object-contain bg-black rounded" alt=""/>
                       <span className="text-[9px] font-bold text-cyan-400 uppercase tracking-tighter">YÜKLENDİ</span>
                       <Trash2 size={14} className="text-red-400 cursor-pointer" onClick={() => removePart(p.id)} />
                    </div>
                  ))}
                </div>
              )}
            </div>
          </div>
        </aside>

        {/* ORTA PANEL: VIEWPORT */}
        <section className="lg:col-span-6 flex flex-col gap-6">
          <div className="relative flex-1 bg-black rounded-[2.5rem] border border-white/10 overflow-hidden shadow-[0_0_50px_rgba(0,0,0,0.5)] group">
            <div className="absolute top-8 left-8 w-12 h-12 border-t-2 border-l-2 border-cyan-500/40 rounded-tl-xl pointer-events-none"></div>
            <div className="absolute top-8 right-8 w-12 h-12 border-t-2 border-r-2 border-cyan-500/40 rounded-tr-xl pointer-events-none"></div>
            <div className="absolute bottom-8 left-8 w-12 h-12 border-b-2 border-l-2 border-cyan-500/40 rounded-bl-xl pointer-events-none"></div>
            <div className="absolute bottom-8 right-8 w-12 h-12 border-b-2 border-r-2 border-cyan-500/40 rounded-br-xl pointer-events-none"></div>

            {!originalImage ? (
              <label className="absolute inset-0 flex flex-col items-center justify-center cursor-pointer transition-all">
                <div className="w-24 h-24 bg-cyan-500/10 rounded-full flex items-center justify-center mb-6 border border-cyan-500/20 group-hover:scale-110 duration-500">
                  <Camera className="text-cyan-400" size={40} />
                </div>
                <h3 className="text-xl font-black italic tracking-widest text-white uppercase">ARACI GARAJA ÇEK</h3>
                <p className="text-slate-500 text-[10px] mt-2 tracking-[0.4em] uppercase">Sistem analiz için veri bekliyor</p>
                <input type="file" className="hidden" onChange={(e) => handleImageUpload(e)} accept="image/*" />
              </label>
            ) : (
              <div className="w-full h-full flex items-center justify-center p-4 bg-[radial-gradient(circle_at_50%_50%,#111_0%,#000_100%)]">
                {modifiedImage ? (
                  <div className="relative w-full h-full touch-none select-none">
                    <img src={modifiedImage} className="absolute inset-0 w-full h-full object-contain p-8" alt="After" />
                    <div className="absolute inset-0 w-full h-full overflow-hidden" style={{ clipPath: `inset(0 ${100 - sliderPosition}% 0 0)` }}>
                      <img src={originalImage} className="w-full h-full object-contain p-8" alt="Before" />
                    </div>
                    <div className="absolute top-0 bottom-0 w-px bg-cyan-500/50 z-20" style={{ left: `${sliderPosition}%` }}>
                      <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-10 h-10 bg-black border border-cyan-500/50 rounded-full flex items-center justify-center shadow-[0_0_20px_rgba(6,182,212,0.4)] cursor-ew-resize">
                        <ChevronRight size={16} className="text-cyan-400" />
                      </div>
                    </div>
                    <input type="range" min="0" max="100" value={sliderPosition} onChange={(e) => setSliderPosition(e.target.value)} className="absolute inset-0 w-full h-full opacity-0 cursor-ew-resize z-30" />
                  </div>
                ) : <img src={originalImage} className="w-full h-full object-contain p-8" alt="Preview" />}
              </div>
            )}

            {isGenerating && (
              <div className="absolute inset-0 bg-black/90 backdrop-blur-md z-50 flex flex-col items-center justify-center">
                 <div className="relative w-24 h-24 mb-8">
                    <div className="absolute inset-0 border-2 border-cyan-500/20 rounded-full"></div>
                    <div className="absolute inset-0 border-t-2 border-cyan-400 rounded-full animate-spin"></div>
                    <Zap className="absolute inset-0 m-auto text-cyan-400 animate-pulse" size={30} />
                 </div>
                 <h3 className="text-2xl font-black italic tracking-[0.5em] text-white uppercase animate-pulse">{statusMessage}</h3>
              </div>
            )}
          </div>

          <div className="grid grid-cols-2 gap-4">
             <div className="bg-white/5 border border-white/10 p-6 rounded-3xl backdrop-blur-sm flex items-center justify-between shadow-lg">
                <div>
                  <p className="text-[9px] font-bold text-slate-500 uppercase tracking-widest mb-1">Seçili Paket</p>
                  <p className="text-lg font-black italic uppercase text-white tracking-tighter leading-none">{selectedStyle.name}</p>
                </div>
                <div className="w-12 h-12 bg-white/5 rounded-2xl flex items-center justify-center text-cyan-400 border border-white/5">{selectedStyle.icon}</div>
             </div>
             <button 
                disabled={!originalImage || isGenerating} 
                onClick={generateModification} 
                className={`relative overflow-hidden rounded-3xl font-black tracking-[0.3em] uppercase text-sm group transition-all duration-500 shadow-2xl ${!originalImage ? 'bg-white/5 text-slate-600 border border-white/5 cursor-not-allowed' : 'bg-cyan-500 text-black hover:shadow-cyan-500/40 hover:scale-[1.02] active:scale-95'}`}
             >
                <span className="relative z-10 flex items-center justify-center gap-3">RENDERI BAŞLAT <Zap size={16} fill="currentColor"/></span>
             </button>
          </div>
        </section>

        {/* SAĞ PANEL: ANALİZ VE GARAJ */}
        <aside className="lg:col-span-3 flex flex-col gap-6">
          <div className="bg-white/5 border border-white/10 rounded-3xl p-6 backdrop-blur-md shadow-2xl">
             <div className="flex items-center justify-between mb-6">
                <h4 className="text-[10px] font-black uppercase tracking-[0.4em] text-cyan-500">Sistem Analizi</h4>
                <Activity size={14} className="text-cyan-500" />
             </div>
             <div className="h-40 relative">
                <Bar data={chartData} options={{ maintainAspectRatio: false, scales: { y: { display: false }, x: { grid: { display: false }, ticks: { color: '#666', font: { size: 9, family: 'monospace' } } } }, plugins: { legend: { display: false } } }} />
             </div>
          </div>

          <div className="bg-white/5 border border-white/10 rounded-3xl p-6 backdrop-blur-md shadow-2xl flex-1 overflow-hidden flex flex-col">
             <div className="flex items-center justify-between mb-6">
                <h4 className="text-[10px] font-black uppercase tracking-[0.4em] text-slate-400">Bulut Garajı</h4>
                <button onClick={() => setShowDownloadModal(true)} disabled={!modifiedImage} className="p-2 bg-cyan-500/10 rounded-lg text-cyan-400 hover:bg-cyan-500 hover:text-black transition-all">
                  <Download size={16} />
                </button>
             </div>
             <div className="grid grid-cols-2 gap-3 overflow-y-auto custom-scrollbar pr-2">
                {garage.length > 0 ? garage.map(item => (
                  <button key={item.id} onClick={() => setModifiedImage(item.result)} className="aspect-square bg-black rounded-xl border border-white/5 overflow-hidden group/item relative">
                     <img src={item.result} className="w-full h-full object-cover opacity-60 group-hover/item:opacity-100 transition-all duration-500" alt=""/>
                     <div className="absolute inset-0 bg-cyan-500/10 opacity-0 group-hover/item:opacity-100 transition-opacity"></div>
                  </button>
                )) : (
                  <div className="col-span-2 py-12 border border-white/5 rounded-2xl border-dashed flex flex-col items-center justify-center opacity-30">
                    <Box size={24} className="mb-2" />
                    <p className="text-[8px] font-black tracking-widest uppercase">Garaj Boş</p>
                  </div>
                )}
             </div>
          </div>
        </aside>
      </main>

      {/* DOWNLOAD MODAL */}
      {showDownloadModal && (
        <div className="fixed inset-0 z-[100] flex items-center justify-center p-6 backdrop-blur-3xl bg-black/80 animate-in fade-in duration-300">
            <div className="bg-[#0a0a0a] w-full max-w-md rounded-[2rem] border border-cyan-500/20 p-10 shadow-[0_0_100px_rgba(6,182,212,0.15)] relative">
                <button onClick={() => setShowDownloadModal(false)} className="absolute top-8 right-8 text-slate-500 hover:text-white transition-colors"><X size={24} /></button>
                <div className="text-center mb-10">
                    <div className="w-20 h-20 bg-cyan-500/10 rounded-full flex items-center justify-center mx-auto mb-6 border border-cyan-500/20"><Download size={32} className="text-cyan-400" /></div>
                    <h2 className="text-2xl font-black tracking-widest italic uppercase text-white">ÇIKTI AL</h2>
                    <p className="text-slate-500 text-[10px] mt-2 tracking-[0.3em] uppercase">Dosya formatı: PNG 8K</p>
                </div>
                <div className="grid gap-4">
                    {[
                      {id: 'original', name: 'Orijinal Ölçek', desc: '1:1 Native Resolution', icon: <Maximize2 size={20}/>},
                      {id: 'pc', name: 'Masaüstü', desc: '16:9 Ultra HD', icon: <Monitor size={20}/>},
                      {id: 'mobile', name: 'Mobil Cihaz', desc: '9:16 Vertical HD', icon: <Smartphone size={20}/>}
                    ].map(t => (
                      <button key={t.id} onClick={() => processDownload(t.id)} className="w-full flex items-center justify-between p-5 bg-white/5 border border-white/10 rounded-2xl hover:bg-cyan-500/10 hover:border-cyan-500/50 transition-all group shadow-lg">
                        <div className="flex items-center gap-4 text-left">
                            <div className="text-cyan-400">{t.icon}</div>
                            <div>
                                <span className="font-black block text-sm uppercase text-white tracking-tighter leading-none">{t.name}</span>
                                <span className="text-[9px] text-slate-500 font-bold uppercase tracking-widest mt-1 inline-block">{t.desc}</span>
                            </div>
                        </div>
                        <ChevronRight className="text-slate-700 group-hover:text-cyan-400 group-hover:translate-x-1 transition-all" size={20} />
                      </button>
                    ))}
                </div>
                {/* Fallback Bilgisi */}
                <p className="text-center text-[8px] text-slate-600 mt-6 uppercase tracking-widest italic">İndirme başlamazsa görselin üzerine basılı tutup kaydedin.</p>
            </div>
        </div>
      )}

      <footer className="relative z-10 py-8 text-center opacity-20">
         <p className="text-[10px] font-black uppercase tracking-[0.8em] text-slate-400">Antigravity Global Tuning Studio — 2025</p>
      </footer>

      <style>{`
        input[type=range]::-webkit-slider-thumb { pointer-events: all; width: 60px; height: 60px; appearance: none; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(34, 211, 238, 0.2); border-radius: 10px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
      `}</style>
    </div>
  );
}
